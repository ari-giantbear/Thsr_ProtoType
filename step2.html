<!DOCTYPE html>
<html lang="zh-TW">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>高鐵聯票 - 選擇車次</title>
    <link rel="stylesheet" href="styles.css?v=1.2.7">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="Dialog.js"></script>

    
<style>
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .navigation a {
            color: #007bff;
            cursor: pointer;
        }

        .summary {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .summary,
        .container .ticket-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }

        .notice {
            padding-left: 20px;
            padding-right: 20px;
            background: #f9f9f9;
        }

        .notice-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
    </style>

    <script>
        let departureIndex = 0;
        let returnIndex = 0;

        //去程所選擇的車次參數
        let outwardDate = '';
        let outwardTrainNo = '';
        let outwardDeptTime = '';
        let outwardDeptStation = '';
        let outwardDuration = '';
        let outwardDestTime = '';
        let outwardDestStation = '';

        //回程所選擇的車次參數  
        let returnDate = '';
        let returnTrainNo = '';
        let returnDeptTime = '';
        let returnDeptStation = '';
        let returnDuration = '';
        let returnDestTime = '';
        let returnDestStation = '';

        //所有車次資料，這是隨機產生的
        const trains = Array.from({ length: 20 }, (_, i) => ({
            startTime: `${12 + Math.floor(i / 2)}:${(30 + i * 3) % 60}`,
            endTime: `${13 + Math.floor(i / 2)}:${(33 + i * 3) % 60}`,
            time: `${12 + Math.floor(i / 2)}:${(30 + i * 3) % 60} → ${13 + Math.floor(i / 2)}:${(33 + i * 3) % 60}`,
            duration: `⏱ 1:${(i % 3) + 1}`,
            trainNo: `🚆 ${600 + i}`
        }));

        //渲染車次
        function renderTrains(type, index) {
            const container = document.querySelector(`.${type} .train-list`);
            container.innerHTML = '';
            trains.slice(index, index + 5).forEach(train => {
                const div = document.createElement('div');
                div.className = 'train-option';
                div.onclick = () => selectTrain(div, type, train);
                div.innerHTML = `<div class='ticket-time'>${train.time} </div> <div class='duration'>${train.duration}</div><div class='train-no'>${train.trainNo}</div>`;
                container.appendChild(div);
            });
        }

        //更換車次
        function changeTrains(type, direction) {
            if (type === 'departure') {
                departureIndex = Math.max(0, Math.min(15, departureIndex + direction * 5));
                renderTrains(type, departureIndex);
            } else {
                returnIndex = Math.max(0, Math.min(15, returnIndex + direction * 5));
                renderTrains(type, returnIndex);
            }
        }

        //選擇車次
        function selectTrain(element, type, train) {
            document.querySelectorAll(`.${type} .train-option`).forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            if (type === 'departure') {
                outwardDeptTime = train.startTime;
                outwardDestTime = train.endTime;
                outwardDuration = train.duration;
                outwardTrainNo = train.trainNo;
            } else {
                returnDeptTime = train.startTime;
                returnDestTime = train.endTime;
                returnDuration = train.duration;
                returnTrainNo = train.trainNo;
            }
            updateSummary();
        }

        //更新訂位明細(車票的內容)
        function updateSummary() {
            document.getElementById("outward-train-no").textContent = outwardTrainNo;
            document.getElementById("outward-dept-time").textContent = outwardDeptTime;
            document.getElementById("outward-dest-time").textContent = outwardDestTime;
            document.getElementById("outward-duration").textContent = outwardDuration;
            document.getElementById("return-train-no").textContent = returnTrainNo;
            document.getElementById("return-dept-time").textContent = returnDeptTime;
            document.getElementById("return-dest-time").textContent = returnDestTime;
            document.getElementById("return-duration").textContent = returnDuration;
        }

        function gotoStep3() {
            // 檢查去程是否已選擇
            if (!outwardTrainNo) {
                showDialog({
                    caption: '車次選擇不完整',
                    message: '請選擇去程車次',
                    /* 可以不需要設定按鈕,採用預設的按鈕即可
                    buttons: [
                        {
                            text: '確定',
                            type: 'primary',
                            onClick: () => closeDialog()
                        }
                    ]
                    */
                });
                return;
            }

            // 檢查是否為去回程
            const returnTicket = document.querySelector('.return');
            if (returnTicket && returnTicket.style.display !== 'none' && !returnTrainNo) {
                showDialog({
                    caption: '車次選擇不完整',
                    message: '請選擇回程車次',
                    buttons: [
                        {
                            text: '確定',
                            type: 'primary',
                            onClick: () => closeDialog()
                        }
                    ]
                });
                return;
            }

            // 如果驗證通過，進行跳轉
            window.location.href = 'step3.html';
        }

        //載入頁面時，渲染車次
        window.onload = function () {
            renderTrains('departure', departureIndex);
            renderTrains('return', returnIndex);
        };
    </script>
</head>

<body>
    <div class="step-nav">
        <div class="step-list">
            <div class="step completed">
                <div class="step-number">1</div>
                <div class="step-text">查詢車次</div>
            </div>
            <div class="step active">
                <div class="step-number">2</div>
                <div class="step-text">選擇車次</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-text">取票資訊</div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-text">完成訂位</div>
            </div>
            <div class="step">
                <div class="step-number">5</div>
                <div class="step-text">繳款完成</div>
            </div>
        </div>
    </div>
    <div class="container departure">
        <div class="title">去程：(台北 → 台中)</div>
        <div class="date">2025/03/20 (星期四)</div>
        <div class="train-list"></div>
        <div class="navigation">
            <a onclick="changeTrains('departure', -1)">← 更早車次</a>
            <a onclick="changeTrains('departure', 1)">更晚車次 →</a>
        </div>
    </div>

    <div class="container return">
        <div class="title">回程：(台中 → 台北)</div>
        <div class="date">2025/03/31 (星期日)</div>
        <div class="train-list"></div>
        <div class="navigation">
            <a onclick="changeTrains('return', -1)">← 更早車次</a>
            <a onclick="changeTrains('return', 1)">更晚車次 →</a>
        </div>
    </div>

    <div class="container">
        <div class="title">訂位明細</div>
        <div class="ticket-area">
            <div class="ticket">
                <div class="ticket-row">
                    <div class="left">
                        <div class="ticket-way">去程</div>
                        <div id="outward-date" class="ticket-date">03/20</div>
                    </div>
                    <div class="right">
                        <div id="outward-train-no" class="ticket-train-no">🚆 621</div>
                    </div>
                </div>
                <div class="ticket-row">
                    <div class="left flex-column">
                        <div id="outward-dept-time" class="ticket-time">09:46</div>
                        <div id="outward-dept-station" class="station">台北</div>
                    </div>
                    <div id="outward-duration" class="through">⏱1:28</div>
                    <div class="right flex-column">
                        <div id="outward-dest-time" class="ticket-time">10:46</div>
                        <div id="outward-dest-station" class="station">台中</div>
                    </div>
                </div>
            </div>

            <div class="ticket">
                <div class="ticket-row">
                    <div class="left">
                        <div class="ticket-way">回程</div>
                        <div id="return-date" class="ticket-date">03/20</div>
                    </div>
                    <div class="right">
                        <div id="return-train-no" class="ticket-train-no">🚆 621</div>
                    </div>
                </div>
                <div class="ticket-row">
                    <div class="left flex-column">
                        <div id="return-dept-time" class="ticket-time">09:46</div>
                        <div id="return-dept-station" class="station">台中</div>
                    </div>
                    <div id="return-duration" class="through">⏱1:28</div>
                    <div class="right flex-column">
                        <div id="return-dest-time" class="ticket-time">10:46</div>
                        <div id="return-dest-station" class="station">台北</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="ticket-detail">
            <span>車廂：</span>
            <span>標準車廂</span>
        </div>
        <div class="ticket-detail">
            <span>票數：</span>
            <span>全票 2 張</span>
        </div>

        <button onclick="gotoStep3()">確認車次</button>
    </div>

    <div class="container">
        <div class="notice">
            <div class="notice-title">注意事項</div>
            <ol>
                <li>本網頁顯示內容為目前於訂位系統搜尋到的可訂車次及票價，實際訂位結果仍以「完成訂位」頁面之內容為主。</li>
                <li>列車時刻及優惠資訊若有變動，以各車站現場公告為準。</li>
            </ol>
        </div>
    </div>

</body>
<script>updateSummary();</script>

</html>